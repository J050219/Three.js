<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <title>ç”¢ç”Ÿç‰©é«”</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script async src="https://unpkg.com/es-module-shims@1/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "/static/node_modules/three/build/three.module.js",
          "three/examples/jsm/controls/OrbitControls.js": "/static/node_modules/three/examples/jsm/controls/OrbitControls.js",
          "three-csg-ts": "/static/node_modules/three-csg-ts/lib/esm/index.js",
          "@tweenjs/tween.js": "/static/node_modules/@tweenjs/tween.js/dist/tween.esm.js"
        }
      }
    </script>
    <style>
      * { box-sizing: border-box; }
      body { margin: 0; overflow: hidden; background: black; font-family: system-ui, sans-serif; }
      #optBar {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10000;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
        padding: 6px 12px;
        background: rgba(30,30,30,0.35);
        border-radius: 10px;
        backdrop-filter: blur(6px);
        pointer-events: auto;
      }
      #optBar .btn{
        font-size: 14px;
        padding: 6px 12px;
        border-radius: 8px;
        border: 1px solid #6ea8fe;
        background: #2f74ff;
        color: #fff;
        cursor: pointer;
      }
      #optBar .btn.ghost{
        background: transparent;
        color: #e6e6e6;
        border-color: #9aa4b2;
      }
      #optBar .btn:hover{ filter: brightness(1.08); }
      #ui {
        position: absolute;
        top: 60px;
        left: 10px;
        background: rgba(255, 255, 255, 0.9);
        padding: 12px;
        border-radius: 10px;
        font-family: sans-serif;
        z-index: 20;
        min-width: 260px;
      }
      .param-group {margin-bottom: 8px;}
      .param-group input {margin: 2px 0 ; display: block;  width: 100px;}
      #library {
        position: absolute;
        top: 240px; left: 10px;
        width: 320px; height: 280px;
        background: rgba(255,255,255,.95);
        border-radius: 10px;
        padding: 10px;
        z-index: 15;
        display: flex;
        overflow: hidden;
        flex-direction: column;
        color: #111;
      }
      #library h3 { margin: 0 0 8px; font-size: 16px; }
      #libraryList {flex: 1 1 auto; overflow: auto; display: block;}
      #libraryList .item {border: 1px solid #ddd; border-radius: 8px; padding: 8px; margin-bottom: 8px; background: #fff;}
      #libraryList .row { font-size: 12px; color:#555; margin-top: 4px; display:flex; align-items:center; gap:6px; }
      #libraryList .chip { width:14px; height:14px; border-radius:3px; border:1px solid #ccc; display:inline-block; }
      #libraryList .btn {margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 6px; border: 0; background:#0ea5e9; color:#fff; cursor:pointer;}
      #video {
        position: absolute;
        bottom: 10px;
        right: 10px;
        width: 200px;
        height: 150px;
        border: 2px solid #00ff00;
        background-color: black;
        z-index: 5;
      }
      button {cursor: pointer;}
    </style>
  </head>
  <body>
    <!-- ğŸ”¹ æ–°å¢æŒ‰éˆ•å€ -->
    <div id="optBar">
      <button onclick="packToTheMax()">æœ€ä½³åŒ–æ“ºæ”¾</button>
      <button onclick="stopAnnealing()">åœæ­¢æœ€ä½³åŒ–</button>

    </div>

    <div id="ui">
        <label>
            é¸æ“‡åœ–å½¢ï¼š
            <select id="shapeType">
                <option value="cube">ç«‹æ–¹é«”</option>
                <option value="circle">çƒé«”</option>
                <option value="lshape">ä¸è¦å‰‡åœ–å½¢</option>
                <option value="tI">I å½¢æ–¹å¡Š</option>
                <option value="tT">T å½¢æ–¹å¡Š</option>
                <option value="tZ">Z å½¢æ–¹å¡Š</option>
                <option value="tL">L å½¢æ–¹å¡Š</option>
            </select>
          </label>
          <div id="boxParams" class="param-group">
            <input id="boxWidth" type="number" placeholder="å¯¬ (Width)" />
            <input id="boxHeight" type="number" placeholder="é«˜ (Height)" />
            <input id="boxDepth" type="number" placeholder="æ·± (Depth)" />
          </div>
          <div id="sphereParams" class="param-group" style="display:none;">
            <input id="sphereWidth" type="number" placeholder="ç›´å¾‘ (Diameter)" />
          </div>
          <div id="customParams" class="param-group" style="display:none;">
            <input id="customWidth" type="number" placeholder="å–®ä½é‚Šé•· (Width)" />
          </div>
          <label>
            é¡è‰²ï¼š
            <input id="color" type="color" value="#00ff00" />
          </label>
          <label>
            <input type="checkbox" id="hasHole" /> æ˜¯å¦ç°ç©º
          </label>
          <div id="holeInput" style="display:none;">
            <input id="holeWidth" type="number" placeholder="å­”å¯¬ (Hole Width)" />
            <input id="holeHeight" type="number" placeholder="å­”é«˜ (Hole Height)" />
          </div>
          <div style="margin-top: 8px"></div>
            <button id="generate">ç”¢ç”Ÿç‰©é«”</button>
            <button id="recognizeBtn" onclick="this.setAttribute('data-clicked', 'true')">è¾¨è­˜åƒæ•¸</button>
          </div>
        </div>
        <aside id="library">
          <h3>ç‰©é«”æ¸…å–®</h3>
          <div id="libraryList"></div>
        </aside>
        <img id="video" src="/get-camera-frame" alt="æ”å½±æ©Ÿç•«é¢" />

        <!-- ä¸»ç¨‹å¼ -->
        <script type="module" src="/static/main.js"></script>

        <!-- ğŸ”¹ æ–°å¢æŒ‰éˆ•äº‹ä»¶é‚è¼¯ -->
        <script>
          window.addEventListener('DOMContentLoaded', () => {
            const optBtn = document.getElementById('optimizeBtn');
            const stopBtn = document.getElementById('stopOptimizeBtn');

            optBtn?.addEventListener('click', () => {
              if (typeof packToTheMax === 'function') packToTheMax();
            });

            stopBtn?.addEventListener('click', () => {
              if (typeof stopAnnealing === 'function') stopAnnealing();
              if (window.ConvergenceChart && typeof ConvergenceChart.stop === 'function')
                ConvergenceChart.stop();
            });
          });
        </script>

        <script>
        function placeLibrary() {
          const ui = document.getElementById('ui');
          const lib = document.getElementById('library');
          if (!ui || !lib) return;
          const r = ui.getBoundingClientRect();
          lib.style.left = r.left + 'px';
          lib.style.top  = (r.bottom + 10) + 'px';
          lib.style.width = r.width + 'px';
          lib.style.height = Math.max(220, Math.min(460, window.innerHeight - (r.bottom + 20))) + 'px';
        }
        addEventListener('load', placeLibrary);
        addEventListener('resize', placeLibrary);
    </script>
  </body>
</html>