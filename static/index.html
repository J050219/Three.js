<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <title>產生物體</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script async src="https://unpkg.com/es-module-shims@1/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
      "imports": {
        "three": "/static/node_modules/three/build/three.module.js",
        "three/examples/jsm/controls/OrbitControls.js": "/static/node_modules/three/examples/jsm/controls/OrbitControls.js",
        "three-csg-ts": "/static/node_modules/three-csg-ts/lib/esm/index.js",
        "@tweenjs/tween.js": "/static/node_modules/@tweenjs/tween.js/dist/tween.esm.js"
      }
    }
    </script>

    <style>
      * { box-sizing: border-box; }
      body { margin: 0; overflow: hidden; background: black; font-family: system-ui, sans-serif; }
      #ui {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(255, 255, 255, 0.9);
        padding: 12px;
        border-radius: 8px;
        font-family: sans-serif;
        z-index: 10;
      }
      .param-group {
        margin-bottom: 10px;
      }
      .param-group input {
        margin: 2px 0 ;
        display: block;
        width: 100px;
      }
      label { display: block; margin: 5px 0; }
      input[type="number"] { width: 80px; }
      #video {
        position: absolute;
        bottom: 10px;
        right: 10px;
        width: 200px;
        height: 150px;
        border: 2px solid #00ff00;
        background-color: black;
        z-index: 5;
      }
      #library {
        position: absolute;
        top: 240px; left: 10px;
        width: 320px; height: 260px;
        background: rgba(255,255,255,.95);
        border-radius: 10px;
        padding: 10px;
        z-index: 12;
        display: flex;
        flex-direction: column;
        color: #111;
      }
      #library h3 { margin: 0 0 8px; font-size: 16px; }
      #libraryList {
        flex: 1 1 auto;
        overflow: auto;
        display: block;
      }
      #libraryList .item {
        border: 1px solid #ddd; border-radius: 8px; padding: 8px; margin-bottom: 8px;
        background: #fff;
      }
      #libraryList .row { font-size: 12px; color:#555; margin-top: 4px; display:flex; align-items:center; gap:6px; }
      #libraryList .chip { width:14px; height:14px; border-radius:3px; border:1px solid #ccc; display:inline-block; }
      #libraryList .btn {
        margin-top: 6px; width: 100%; padding: 6px 8px; border-radius: 6px; border: 0;
        background:#0ea5e9; color:#fff; cursor:pointer;
      }
    </style>
  </head>
  <body>
    <div id="ui">
        <label>
            選擇圖形：
            <select id="shapeType">
                <option value="cube">立方體</option>
                <option value="circle">球體</option>
                <option value="lshape">不規則圖形</option>
                <option value="tI">I 形方塊</option>
                <option value="tT">T 形方塊</option>
                <option value="tZ">Z 形方塊</option>
                <option value="tL">L 形方塊</option>
            </select>
        </label>
        <div id="boxParams" class="param-group">
            <input id="boxWidth" type="number" placeholder="寬 (Width)" />
            <input id="boxHeight" type="number" placeholder="高 (Height)" />
            <input id="boxDepth" type="number" placeholder="深 (Depth)" />
        </div>

        <div id="sphereParams" class="param-group" style="display:none;">
            <input id="sphereWidth" type="number" placeholder="半徑 (Radius)" />
        </div>

        <div id="customParams" class="param-group" style="display:none;">
            <input id="customWidth" type="number" placeholder="寬 (Width)" />
            <input id="customHeight" type="number" placeholder="高 (Height)" />
            <input id="customDepth" type="number" placeholder="厚度 (Depth)" />
        </div>

        <label>
            顏色：
            <input id="color" type="color" value="#00ff00" />
        </label>

        <label>
            <input type="checkbox" id="hasHole" /> 是否簍空
        </label>

        <div id="holeInput" style="display:none;">
            <input id="holeWidth" type="number" placeholder="孔寬 (Hole Width)" />
            <input id="holeHeight" type="number" placeholder="孔高 (Hole Height)" />
        </div>
        <button id="generate">產生物體</button>
        <button id="recognizeBtn" onclick="this.setAttribute('data-clicked', 'true')">辨識參數</button>
        <button id="optimizeBtn" class="btn">最佳化擺放</button>
        <button id="stopOptimizeBtn" class="btn">停止最佳化</button>
    </div>
    <aside id="library">
      <h3>物體清單</h3>
      <div id="libraryList" style="font-size:14px; color:#333;"></div>
    </aside>

    <img id="video" src="/get-camera-frame" alt="攝影機畫面" />

    <script type="module" src="/static/main.js"></script>
    <script>
      function placeLibrary() {
        const ui = document.getElementById('ui');
        const lib = document.getElementById('library');
        if (!ui || !lib) return;
        const r = ui.getBoundingClientRect();

        lib.style.left = r.left + 'px';
        lib.style.top  = (r.bottom + 10) + 'px';
        lib.style.width = r.width + 'px';

        // 依剩餘空間調整高度（最少 160px，最多 340px）
        const maxH = window.innerHeight - (r.bottom + 20);
        //const h = Math.max(220, Math.min(460, maxH));
        lib.style.height = Math.max(220, Math.min(460, maxH)) + 'px';
      }
      window.addEventListener('load', placeLibrary);
      window.addEventListener('resize', placeLibrary);
    </script>
  </body>
</html>