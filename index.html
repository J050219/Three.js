<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <title>ç”¢ç”Ÿç‰©é«”</title>
    <style>
      body { margin: 0; overflow: hidden; background: black; }
      #ui {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(255, 255, 255, 0.9);
        padding: 12px;
        border-radius: 8px;
        font-family: sans-serif;
        z-index: 10;
      }
      .param-group {
        margin-bottom: 10px;
      }
      .param-group input {
        margin: 2px 0 ;
        display: block;
        width: 100px;
      }
      label { display: block; margin: 5px 0; }
      input[type="number"] { width: 80px; }
      #video {
        position: absolute;
        bottom: 10px;
        right: 10px;
        width: 200px;
        height: 150px;
        border: 2px solid #00ff00;
        background-color: black;
        z-index: 5;
      }
    </style>
  </head>
  <body>
    <div id="ui">
        <label>
            é¸æ“‡åœ–å½¢ï¼š
            <select id="shapeType">
                <option value="cube">ç«‹æ–¹é«”</option>
                <option value="circle">çƒé«”</option>
                <option value="lshape">ä¸è¦å‰‡åœ–å½¢</option>
            </select>
        </label>
        <div id="boxParams" class="param-group">
            <input id="boxWidth" type="number" placeholder="å¯¬ (Width)" />
            <input id="boxHeight" type="number" placeholder="é«˜ (Height)" />
            <input id="boxDepth" type="number" placeholder="æ·± (Depth)" />
        </div>

        <div id="sphereParams" class="param-group" style="display:none;">
            <input id="sphereWidth" type="number" placeholder="ç›´å¾‘ (Diameter)" />
        </div>

        <div id="customParams" class="param-group" style="display:none;">
            <input id="customWidth" type="number" placeholder="å¯¬ (Width)" />
            <input id="customHeight" type="number" placeholder="é«˜ (Height)" />
            <input id="customDepth" type="number" placeholder="åšåº¦ (Depth)" />
        </div>

        <label>
            é¡è‰²ï¼š
            <input id="color" type="color" value="#00ff00" />
        </label>

        <label>
            <input type="checkbox" id="hasHole" /> æ˜¯å¦ç°ç©º
        </label>

        <div id="holeInput" style="display:none;">
            <input id="holeWidth" type="number" placeholder="å­”å¯¬ (Hole Width)" />
            <input id="holeHeight" type="number" placeholder="å­”é«˜ (Hole Height)" />
        </div>
        <button id="generate">ç”¢ç”Ÿç‰©é«”</button>
        <button id="recognizeBtn">è¾¨è­˜åƒæ•¸</button>


    </div>

    <img id="video" src="http://127.0.0.1:5000/get-camera-frame" alt="æ”å½±æ©Ÿç•«é¢" />


    <script type="module">
      import { createRecognizer } from './recognizer.js';
      (async () => {
        const video = document.getElementById('video');
        const recognize = await createRecognizer(video);

        const colorMap = {
          'ç´…': '#ff0000',
          'ç´…è‰²': '#ff0000',
          'è—': '#0000ff',
          'è—è‰²': '#0000ff',
          'ç¶ ': '#00ff00',
          'ç¶ è‰²': '#00ff00',
          'ç™½': '#ffffff',
          'ç™½è‰²': '#ffffff',
          'é»‘': '#000000',
          'é»‘è‰²': '#000000',
          'ç´«': '#800080',
          'ç´«è‰²': '#800080',
          'é»ƒ': '#ffff00',
          'é»ƒè‰²': '#ffff00'
      };

        // ğŸ”„ æ ¹æ“š shapeType åˆ‡æ›æ¬„ä½
        document.getElementById('shapeType').addEventListener('change', () => {
          const type = document.getElementById('shapeType').value;
          document.getElementById('boxParams').style.display = type === 'cube' ? 'block' : 'none';
          document.getElementById('sphereParams').style.display = type === 'circle' ? 'block' : 'none';
          document.getElementById('customParams').style.display = type === 'lshape' ? 'block' : 'none';
        });

        // ğŸ”„ æ ¹æ“šæ˜¯å¦ç°ç©ºåˆ‡æ›å­”æ´æ¬„ä½
        document.getElementById('hasHole').addEventListener('change', () => {
          const checked = document.getElementById('hasHole').checked;
          document.getElementById('holeInput').style.display = checked ? 'block' : 'none';
        });

        document.getElementById('recognizeBtn').addEventListener('click', async () => {
          await recognize((data) => {
            if (!data) return;
            const {
              type, width, height, depth,
              color, hasHole, holeWidth, holeHeight
            } = data;

            document.getElementById('shapeType').value = type;
            document.getElementById('shapeType').dispatchEvent(new Event('change'));

            let hexColor = color;
            if (!/^#?[0-9a-fA-F]{6}$/.test(color)) {
              hexColor = colorMap[color.trim()] || '#00ff00';
            }
            if (!hexColor.startsWith('#')) {
              hexColor = '#' + hexColor;
            }
            document.getElementById('color').value = hexColor;
            document.getElementById('hasHole').checked = hasHole;
            document.getElementById('hasHole').dispatchEvent(new Event('change'));
          //document.getElementById('holeInput').style.display = hasHole ? 'block' : 'none';

          if (type === 'cube') {
            document.getElementById('boxWidth').value = width;
            document.getElementById('boxHeight').value = height;
            document.getElementById('boxDepth').value = depth;
          } else if (type === 'circle') {
            document.getElementById('sphereWidth').value = width;
          } else if (type === 'lshape') {
            document.getElementById('customWidth').value = width;
            document.getElementById('customHeight').value = height;
            document.getElementById('customDepth').value = depth;
          }

          document.getElementById('holeWidth').value = holeWidth;
          document.getElementById('holeHeight').value = holeHeight;
        });
      });
    })();
    </script>
    <script type="module" src="/main.js"></script>
  </body>
</html>